/* nbdesignerjs
 * @author  netbaseteam
 * @link https://cmsmart.net
 * @version 1.3.1
 * */
function checkFireFox(){if(-1<navigator.userAgent.toLowerCase().indexOf("firefox"))return!0}var langjs={DELETE_ITEM_MESSAGE:"Are you sure you want to delete this item?",DELETE_ALL_ITEM_MESSAGE:"Are you sure you want to delete all layers?",LAYER_IMAGE:"Image",LAYER_GROUP:"Group",LAYER_PATH:"Path",LAYER_RECTANGLE:"Rectangle",LAYER_CIRCLE:"Circle",LAYER_TRIANGLE:"Triangle",LAYER_LINE:"Line",LAYER_POLYGON:"Polygon"};
function checkIE(){return 0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1}
(function(a){var b,e,g,h,d,k=a.body,l=a.createElement("div");l.innerHTML='<span style="'+["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;")+'">'+Array(100).join("wi")+"</span>";l=l.firstChild;b=function(a){l.style.fontFamily=a;k.appendChild(l);d=l.clientWidth;k.removeChild(l);return d};e=b("monospace");g=b("serif");h=b("sans-serif");window.isFontAvailable=function(a){return e!==b(a+",monospace")||h!==b(a+",sans-serif")||g!==b(a+",serif")}})(document);
window.performance=window.performance||{};performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||Date.now}();var canvas=null,canvasContainerX=0,canvasContainerY=0,colorTrend="f98332 A31A48 4C49A2 B8DC3C CB2402 DB2464 35235D EA3556 61D2D6 EDE5E2 ED146F EDDE45 9BF0E9".split(" ");
function hexToRGB(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,e,g,h){return e+e+g+g+h+h});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function toType(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}
function changePattern(a){fabric.util.loadImage(a,function(a){a=new fabric.Pattern({source:a,repeat:"repeat"});var b=angular.element(document.getElementById("designer-controller")).scope();b.canvas.item(b.editableItem).fill=a;b.canvas.setActiveObject(b.canvas.item(b.canvas.getObjects().length-1));"$apply"!==b.$root.$$phase&&"$digest"!==b.$root.$$phase&&b.$apply()})}function degToRad(a){return Math.PI/180*a}function show_indicator(){$(".od_processing").show();$(".od_processing").css("opacity",1)}
function checkNavigator(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),e=!0;0<b&&10>parseInt(a.substring(b+5,a.indexOf(".",b)),10)&&(e=!1);return e}function hide_indicator(){checkNavigator()?($(".od_processing").hide(),$(".od_processing").css("opacity",0)):($("#first_message").html("Oops! My app not support IE version less than 10...<br /><span>Try with model browser.</span>"),$(".od_processing").show(),$(".od_processing").css("opacity",1))}
function show_processing(){$("#nbdesigner_processing").addClass("show")}function hide_processing(){$("#nbdesigner_processing").removeClass("show")}
function addColorStop(){jQuery("#gradient").append('<div class="row container_color_stop"><div class="col-xs-6"><input type="text" class="ip_shadow jscolor gradient_stop_color" value="F98332" ><input type="text" class="ip_shadow special gradient_stop" value="0"></div><div class="col-xs-5 nb_slider"></div><div class="clear"></div></div>');jQuery(".nb_slider").slider({animate:!0,slide:function(a,b){jQuery(this).parent().find(".gradient_stop").val(b.value/100)}});jscolor.installByClassName("jscolor")}
function removeColorStop(){jQuery("#gradient .container_color_stop:last-child").remove()}function createGradient(){var a={},b=jQuery("#gradient .container_color_stop").length-1;jQuery("#gradient .container_color_stop").each(function(e,g){var h;h=jQuery(this).find(".gradient_stop").val();0==e&&(h=0);e==b&&(h=1);temp=h;var d="#"+jQuery(this).find(".gradient_stop_color").val();a[h]=d});return a}
function getBinary(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.overrideMimeType("text/plain; charset=x-user-defined");b.send(null);return b.responseText}
function base64Encode(a){for(var b="",e=0,g=a.length,h,d,k;e<g;){h=a.charCodeAt(e++)&255;if(e==g){b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>2);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&3)<<4);b+="==";break}d=a.charCodeAt(e++);if(e==g){b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>2);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&3)<<4|(d&240)>>4);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((d&
15)<<2);b+="=";break}k=a.charCodeAt(e++);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>2);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&3)<<4|(d&240)>>4);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((d&15)<<2|(k&192)>>6);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k&63)}return b}
function checkMobileDevice(){var a=!1;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,
4)))a=!0;return a}
(function(){function a(a,b){var d=angular.element(document.getElementById("designer-controller")).scope(),k=d.canvas.getActiveObject();null!=k&&(k.filters[a]=b,k.applyFilters(function(){d.canvas.renderAll(canvas.renderAll.bind(canvas))}),"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply())}function b(a,b,l){var d=angular.element(document.getElementById("designer-controller")).scope(),k=d.canvas.getActiveObject();null!=k&&(k.filters[a]&&(k.filters[a][b]=l,k.applyFilters(canvas.renderAll.bind(canvas))),"$apply"!==
d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply())}function e(a){var d=angular.element(document.getElementById("designer-controller")).scope(),b=new fabric.Path(d.currentPathCrop),e=a.get("scaleX"),h=canvas2.item(1).get("scaleX"),g=canvas2.width,n=canvas2.height;a.get("width");a.get("height");a.get("left");a.get("top");b.set({originX:"center",originY:"center",left:1*(a.get("left")-g/2)/h,top:1*(a.get("top")-n/2)/h,scaleX:1/h*e,scaleY:1/h*e,angle:a.angle,fill:"#9bf0e9",strokeWidth:0,opacity:0});
canvas2.item(1).set({clipTo:function(a){b.render(a)}});"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}jQuery("#dg-outline-width").slider({animate:!0,slide:function(a,b){jQuery(".outline-value").html(b.value);var d=angular.element(document.getElementById("designer-controller")).scope();d.editable.strokeTemp=b.value/100*5;d.changeStroke(null,d.editable.strokeTemp);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery(".nb_slider").slider({animate:!0,slide:function(a,
b){jQuery(this).parent().find(".gradient_stop").val(b.value/100)}});jQuery("#opacity-text").slider({animate:!0,min:0,max:1,step:.01,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.setOpacity(b.value);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery('[data-toggle="tooltip"]').tooltip();jQuery("#text-arc").slider({animate:!0,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();
jQuery("#text-arc-value").html(b.value);d.changeCurve(b.value);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#shadow_x, #image_shadow_x").slider({animate:!0,min:0,max:25,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.shadow.x=b.value;d.changeShadow();"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#shadow_blur, #image_shadow_blur").slider({animate:!0,min:0,max:25,slide:function(a,b){var d=
angular.element(document.getElementById("designer-controller")).scope();d.shadow.blur=b.value;d.changeShadow();"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#brush_width").slider({animate:!0,min:0,max:50,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.brushWidth=b.value;d.setDrawingLineWidth(d.brushWidth);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#brush_opacity").slider({animate:!0,
min:0,max:1,step:.01,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.brushOpacity=1-b.value;d.setDrawingLineOpacity(d.brushOpacity);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#brush_shadow_width").slider({animate:!0,min:0,max:150,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.brushShadowWidth=b.value;d.setDrawingLineShadowWidth(d.brushShadowWidth);"$apply"!==
d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#shadow_y, #image_shadow_y").slider({animate:!0,min:0,max:25,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.shadow.y=b.value;d.changeShadow();"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#shadow_alpha, #image_shadow_alpha").slider({animate:!0,min:0,max:1,step:.01,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();
d.shadow.alpha=1-b.value;d.changeShadow();"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#opacity_shape").slider({animate:!0,min:0,max:1,step:.01,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();d.setOpacity(b.value);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});jQuery("#opacity_svg, #image_opacity").slider({animate:!0,min:0,max:1,step:.01,slide:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope();
d.setOpacity(b.value);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}});$("a.nb_toggle_popoup").on("click",function(a){a.preventDefault();$(this).parent().find("div.nb_toggle_popoup").toggle()});$("#rotation-text, #rotation-image, #rotation-shape, #rotation-svg").knob({width:50,height:50,min:-1,max:360,fgColor:"#DD577A",bgColor:"#9BF0E9",displayPrevious:!1,readOnly:!1,cursor:10,thickness:".3",change:function(a){var d=canvas.getActiveObject();null!=d&&(d.setAngle(a),canvas.renderAll())},
release:function(a){var d=canvas.getActiveObject();null!=d&&(d.setAngle(a),canvas.renderAll())}});$(".accordion").accordion({collapsible:!0,heightStyle:"content"});$(".nb_acc, .has-croll").perfectScrollbar();jQuery(".popovers").length&&jQuery(".popovers").popover();f=fabric.Image.filters;$("#grayscale-filter").on("change",function(){a(0,this.checked&&new f.Grayscale)});$("#invert-filter").on("change",function(){a(1,this.checked&&new f.Invert)});$("#sepia-filter").on("change",function(){a(3,this.checked&&
new f.Sepia)});$("#sepia2-filter").on("change",function(){a(4,this.checked&&new f.Sepia2)});$("#remove-color-filter").on("change",function(){a(20,this.checked&&new f.RemoveColor({color:[255,205,109]}))});$("#remove-white-filter").on("change",function(){a(2,this.checked&&new f.RemoveWhite({threshold:$("#remove-white-threshold").value,distance:$("#remove-white-distance").value}))});$("#brightness-filter").on("change",function(){a(5,this.checked&&new f.Brightness({brightness:parseInt($("#brightness-value").value,
10)}))});$("#noise-filter").on("change",function(){a(6,this.checked&&new f.Noise({noise:parseInt($("#noise-value").value,10)}))});$("#gradient-transparency-filter").on("change",function(){a(7,this.checked&&new f.GradientTransparency({threshold:parseInt($("#gradient-transparency-value").value,10)}))});$("#pixelate-filter").on("change",function(){a(8,this.checked&&new f.Pixelate({blocksize:parseInt($("#pixelate-value").value,10)}))});$("#blur-filter").on("change",function(){a(9,this.checked&&new f.Convolute({matrix:[1/
9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}))});$("#sharpen-filter").on("change",function(){a(10,this.checked&&new f.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))});$("#emboss-filter").on("change",function(){a(11,this.checked&&new f.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))});$("#edge-enhance-filter").on("change",function(){a(11,this.checked&&new f.Convolute({matrix:[-1,-1,-1,-1,9,-1,-1,-1,-1]}))});$("#tint-filter").on("change",function(){a(12,this.checked&&new f.Tint({color:jQuery("#tint-color").val(),
opacity:parseFloat(jQuery("#tint-opacity").val())}))});$("#tint-color").on("change",function(){b(12,"color",this.value)});$("#multiply-filter").on("change",function(){a(13,this.checked&&new f.Multiply({color:document.getElementById("multiply-color").value}))});$("#multiply-color").on("change",function(){b(13,"color",this.value)});var g="add";$("#blend-filter").on("change",function(){a(14,this.checked&&new f.Blend({color:document.getElementById("blend-color").value,mode:g}))});changeBlendMode=function(a){g=
a;b(14,"mode",a)};$("#blend-color").on("change",function(){b(14,"color",this.value)});var h={grayscale:0,invert:1,"remove-white":2,sepia:3,sepia2:4,brightness:5,noise:6,"gradient-transparency":7,pixelate:8,blur:9,sharpen:10,emboss:11,tint:12,multiply:13,blend:14,"edge-enhance":15};jQuery(".remove-white-threshold, .remove-white-distance, .brightness-value, .gradient-transparency-value").slider({animate:!0,max:255,slide:function(a,e){var d=h[jQuery(this).next().data("parent")],k=jQuery(this).next().data("type");
jQuery(this).next().val(e.value);b(d,k,parseInt(e.value))}});jQuery(".noise-value").slider({animate:!0,max:1E3,slide:function(a,e){var d=h[jQuery(this).next().data("parent")],k=jQuery(this).next().data("type");jQuery(this).next().val(e.value);b(d,k,parseInt(e.value))}});jQuery(".pixelate-value").slider({animate:!0,min:2,max:20,slide:function(a,e){var d=h[jQuery(this).next().data("parent")],k=jQuery(this).next().data("type");jQuery(this).next().val(e.value);b(d,k,parseInt(e.value))}});jQuery(".tint-opacity").slider({animate:!0,
min:0,max:1,step:.1,slide:function(a,e){var d=h[jQuery(this).next().data("parent")],k=jQuery(this).next().data("type");jQuery(this).next().val(e.value);b(d,k,parseFloat(e.value))}});applyImageFilters=function(){canvas.forEachObject(function(a){"image"===a.type&&a.filters.length&&a.applyFilters(function(){a.canvas.renderAll()})})};checkMobileDevice()||jQuery("#layers").sortable({stop:function(a,b){var d=angular.element(document.getElementById("designer-controller")).scope(),e=[];jQuery("#layers .layer").each(function(){e.push(jQuery(this).attr("id").replace("layer-",
""))});e=e.reverse();if(1!=e.length){var k=[],h=[];_.each(e,function(a,d){e[d]=parseInt(a);0!=e[d]-d&&k.push(d);if(1<e[d]-d||-1>e[d]-d)h.push(e[d]),h.push(d)});if(0==h.length)var g=k[0],p=k[1];else g=h[0],p=h[1];d.sortLayer(g,p);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()}}});canvas=new fabric.Canvas("designer-canvas");canvas.selection=!0;canvas.on("selection:cleared",function(a){a=angular.element(document.getElementById("designer-controller")).scope();a.canvas=canvas;a.closePopover();
"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply();var d=!1;768>$(window).width()&&(d=!0);d&&hideConfig();$("#addition_tool").hasClass("open")&&$("#addition_tool .menu_right").triggerHandler("click");a.editableItem=null;a.shapeMode=!1});canvas.on("mouse:down",function(a){var d=angular.element(document.getElementById("designer-controller")).scope();"undefined"!=typeof a.target&&"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()});canvas.on("mouse:over",function(a){canvas.getObjects().indexOf(a.target);
canvas.getObjects().indexOf(canvas.getActiveObject());a=angular.element(document.getElementById("designer-controller")).scope();"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply();canvas.renderAll()});canvas.on("mouse:out",function(a){canvas.renderAll()});canvas.on("mouse:up",function(a){angular.element(document.getElementById("designer-controller")).scope()});canvas.on("path:created",function(a){a=angular.element(document.getElementById("designer-controller")).scope();var d=a.canvas.getObjects().length-
1;a.addLayers(a.canvas.item(d),a.canvas.item(d).get("type"),d);showLayer();"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()});canvas.on("object:selected",function(a){var d=angular.element(document.getElementById("designer-controller")).scope();a=a.target;var b=canvas.getObjects().indexOf(canvas.getActiveObject()),e=!1;768>$(window).width()&&(e=!0);e||showLayer();showConfig();canvas.getActiveObject().set({borderColor:"rgba(220, 220, 220, 1)",borderWidth:10,hasRotatingPoint:!1,cornerSize:12,
borderOpacityWhenMoving:1,lockUniScaling:d.lockProportion});d.editableItem=b;e=d.editable.angle=a.angle;360<a.angle&&(e-=360);0>e&&(e+=360);e=parseInt(e);d.editable.pattern=!1;d.editable.width=a.getWidth();d.editable.height=a.getHeight();d.currentLayerActive=b;d.editable.type=a.type;"string"===toType(a.getFill())?d.editable.fill=a.getFill():"object"===toType(a.getFill())&&(d.editable.pattern=!0);d.editable.stroke=a.getStroke();d.editable.strokeWidth=20*a.getStrokeWidth();if("i-text"===a.type||"text"===
a.type||"curvedText"===a.type)d.showPopover("text"),d.editable.text=a.getText(),d.editable.textAlign=a.getTextAlign(),d.editable.fontFamily=a.get("fontName"),$("#rotation-text").val(e).trigger("change");if("image"===a.type||"custom-image"===a.type)d.showPopover("art"),$("#rotation-image").val(e).trigger("change"),b=a.get("opacity"),$("#image_opacity").slider("value",1-b);if("rect"===a.type||"triangle"===a.type||"line"===a.type||"polygon"===a.type||"circle"===a.type)b=a.get("opacity"),$("#opacity_shape").slider("value",
1-b),$("#rotation-shape").val(e).trigger("change"),d.showPopover("draw"),d.shapeMode=!0;d.editable.effect="curvedText"===a.type?"block":"none";if("path-group"===a.type||"path"===a.type)d.showPopover("clipArt"),b=a.get("opacity"),$("#rotation-svg").val(e).trigger("change"),$("#opacity_svg").slider("value",1-b);"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()});canvas.on("object:scaling",function(a){a=a.target;var d=angular.element(document.getElementById("designer-controller")).scope();
d.editable.width=a.getWidth();d.editable.height=a.getHeight();"$apply"!==d.$root.$$phase&&"$digest"!==d.$root.$$phase&&d.$apply()});canvas.on("object:moving",function(a){});canvas.on("object:rotating",function(a){a=a.target;angular.element(document.getElementById("designer-controller")).scope();canvas.getObjects().indexOf(canvas.getActiveObject());var d=a.angle;360<a.angle&&(d-=360);0>d&&(d+=360);d=parseInt(d);"i-text"!==a.type&&"text"!==a.type&&"curvedText"!==a.type||$("#rotation-text").val(d).trigger("update");
"image"!==a.type&&"custom-image"!==a.type||$("#rotation-image").val(d).trigger("change");"rect"!==a.type&&"triagle"!==a.type&&"line"!==a.type&&"polygon"!==a.type&&"circle"!==a.type||$("#rotation-shape").val(d).trigger("change");"path-group"!==a.type&&"path"!==a.type||$("#rotation-svg").val(d).trigger("change")});canvas.on("object:modified",function(a){a=a.target;var d=angular.element(document.getElementById("designer-controller")).scope(),b=canvas.getObjects().indexOf(canvas.getActiveObject());d.editableItem=
b;d.canvas=canvas;b=a.angle;360<a.angle&&(b-=360);0>b&&(b+=360);b=parseInt(b);d.editable.angle=b;if("i-text"===a.type||"text"===a.type||"curvedText"===a.type)d.editable.spacing=a.get("spacing"),d.editable.text=a.getText(),$("#rotation-text").val(b).trigger("change");d.editable.width=a.getWidth();d.editable.height=a.getHeight();"image"!==a.type&&"custom-image"!==a.type||$("#rotation-image").val(b).trigger("change");"rect"!==a.type&&"triagle"!==a.type&&"line"!==a.type&&"polygon"!==a.type&&"circle"!==
a.type||$("#rotation-shape").val(b).trigger("change");"path-group"!==a.type&&"path"!==a.type||$("#rotation-svg").val(b).trigger("change");d.$apply()});canvas.on("before:render",function(){var a=angular.element(document.getElementById("designer-controller")).scope();a.processing=0;"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()});canvas.on("after:render",function(a){a=angular.element(document.getElementById("designer-controller")).scope();a.processing=100;"$apply"!==a.$root.$$phase&&
"$digest"!==a.$root.$$phase&&a.$apply()});canvas2=new fabric.Canvas("crop_canvas");canvas2.on("object:moving",function(a){e(a.target)});canvas2.on("object:rotating",function(a){e(a.target)});canvas2.on("object:scaling",function(a){e(a.target)});canvas2.on("object:modified",function(a){e(a.target)});canvas2.on("object:selected",function(a){e(a.target)});canvas2.on("path:created",function(){canvas2.isDrawingMode=!1;var a=angular.element(document.getElementById("designer-controller")).scope(),b=canvas2.getObjects().length;
canvas2.item(2)&&3<b&&canvas2.remove(canvas2.item(2));a.currentPathCrop=canvas2.item(2).path;b=canvas2.item(2);canvas2.item(2).set({centeredScaling:!0,hasRotatingPoint:!1});canvas2.item(2).setControlVisible("tl",!1);canvas2.item(2).setControlVisible("bl",!1);canvas2.setActiveObject(b);canvas2.renderAll();e(b);"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()});angular.module("app",["LocalStorageModule","angularFileUpload","imgpreload"]).constant("_",window._).config(function(a){a.prefix=
"nbdesigner"})})();
var listPath={path_mark:"M1.398,84.129c3.305,20.461,9.73,50.635,13.591,67.385c2.354,10.212,12.549,23.734,18.51,30.02c4.923,5.191,27.513,23.343,38.34,27.589c18.604,7.295,33.984,4.187,46.012-8.306c12.028-12.493,25.595-34.78,27.954-43.994c2.587-10.105,5.065-26.842,4.313-37.243c-1.036-14.316-14.224-69.332-16.806-79.55c-4.48-17.735-26.246-48.821-80.609-37.668C-1.66,13.514-1.879,63.844,1.398,84.129z",path_crop:"M0 0 L0 100 L100 100 L100 0Z",path_1:"M 12 0 l 2.139 2.629 l 3.068 -1.441 l 0.786 3.297 l 3.389 0.033 l -0.722 3.312 l 3.039 1.5 l -2.088 2.67 l 2.088 2.67 l -3.039 1.5 l 0.722 3.312 l -3.389 0.033 l -0.786 3.297 l -3.068 -1.441 l -2.139 2.629 l -2.139 -2.629 l -3.068 1.441 l -0.786 -3.297 l -3.389 -0.033 l 0.722 -3.312 l -3.039 -1.5 l 2.088 -2.67 l -2.088 -2.67 l 3.039 -1.5 l -0.722 -3.312 l 3.389 -0.033 l 0.786 -3.297 l 3.068 1.441 Z",path_2:"M 0.054 23 c 0.971 -1.912 2.048 -4.538 1.993 -6.368 c -1.308 -1.562 -2.047 -3.575 -2.047 -5.625 c 0 -5.781 5.662 -10.007 12 -10.007 c 6.299 0 12 4.195 12 10.007 c 0 6.052 -6.732 11.705 -15.968 9.458 c -1.678 1.027 -5.377 2.065 -7.978 2.535 Z",
path_3:"M-12,0a12,12 0 1,0 24,0a12,12 0 1,0 -24,0",path_4:"M 9 0 c -5 0 -9 7 -9 14 c 0 5 3 10 9 10 c 6 0 9 -5 9 -10 c 0 -7 -4 -14 -9 -14 Z",path_5:"M 12 4.248 c -3.148 -5.402 -12 -3.825 -12 2.944 c 0 4.661 5.571 9.427 12 15.808 c 6.43 -6.381 12 -11.147 12 -15.808 c 0 -6.792 -8.875 -8.306 -12 -2.944 Z",path_6:"M 18 1 l -6 4 l -6 -4 l -6 5 v 7 l 12 10 l 12 -10 v -7 Z",path_7:"M 24 16.971 l -7.029 7.029 h -9.942 l -7.029 -7.029 v -9.942 l 7.029 -7.029 h 9.942 l 7.029 7.029 Z",path_8:"M 12 0 c -2.995 2.995 -7.486 4 -11 4 c 0 8.583 5.068 16.097 11 20 c 5.932 -3.903 11 -11.417 11 -20 c -3.514 0 -8.005 -1.005 -11 -4 Z",
path_9:"M 1 4 c 0 8.578 5.071 16.1 11 20 c 5.929 -3.9 11 -11.422 11 -20 c -2.828 -2.329 -7.153 -4 -11 -4 c -3.838 0 -8.172 1.671 -11 4 Z",path_10:"M 12 0.587 l 3.668 7.568 l 8.332 1.151 l -6.064 5.828 l 1.48 8.279 l -7.416 -3.967 l -7.417 3.967 l 1.481 -8.279 l -6.064 -5.828 l 8.332 -1.151 Z",path_11:"M 0.000 16.000 L 12.000 20.785 L 13.856 8.000 L 24.000 0.000 L 13.856 -8.000 L 12.000 -20.785 L 0.000 -16.000 L -12.000 -20.785 L -13.856 -8.000 L -24.000 0.000 L -13.856 8.000 L -12.000 20.785 z",path_12:"M10,10 h20 a2,2 0 0 0.1 2,2 v20 a2,2 0 0 0.1 -2,2 h-20 a2,2 0 0 0.1 -2,-2 v-20 a2,2 0 0 0.1 2,-2 z",
path_13:"M0 0 L24 0 L12 20.78z"};"use strict";var topLeftImage=new Image;topLeftImage.src=od_mainURL+"images/fa_times.png";var topRightImage=new Image;topRightImage.src=od_mainURL+"images/fa_rotate.png";var bottomRightImage=new Image;bottomRightImage.src=od_mainURL+"images/fa_resize.png";var bottomLeftImage=new Image;bottomLeftImage.src=od_mainURL+"images/fa_layers.png";function isVML(){return"undefined"!==typeof G_vmlCanvasManager}
fabric.Object.prototype._drawControl=function(a,b,e,g,h){e=this.cornerSize;this.isControlVisible(a)&&(isVML()||this.transparentCorners||b.clearRect(g,h,e,e),b.strokeStyle="rgba(220, 220, 220, 1)",b.lineWidth=1,"tl"==a?(b.drawImage(topLeftImage,g,h,e,e),b.strokeRect(g,h,e,e)):"tr"==a?(b.drawImage(topRightImage,g,h,e,e),b.strokeRect(g,h,e,e)):"bl"==a?(b.drawImage(bottomLeftImage,g,h,e,e),b.strokeRect(g,h,e,e)):"br"==a&&(b.drawImage(bottomRightImage,g,h,e,e),b.strokeRect(g,h,e,e)))};
fabric.Canvas.prototype._getActionFromCorner=function(a,b){var e="drag";if(b&&(e="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"tl"===b?"rotate":"scale","tr"==b&&(e="rotate"),"tl"==b&&(e="delete",deleteObject()),"bl"==b)){var e="layer",g=angular.element(document.getElementById("designer-controller")).scope();g.duplicateItem();"$apply"!==g.$root.$$phase&&"$digest"!==g.$root.$$phase&&g.$apply()}return e};
function deleteObject(a){$.confirm({text:langjs.DELETE_ITEM_MESSAGE,confirm:function(){var b=angular.element(document.getElementById("designer-controller")).scope();null==a?(b.canvas.remove(b.canvas.getActiveObject()),b.editableItem=null,b.closePopover()):b.canvas.remove(b.canvas.item(a));b.drawCanvas();b.saveDesign();b.updateCurrentLayerAfterDelete();"$apply"!==b.$root.$$phase&&"$digest"!==b.$root.$$phase&&b.$apply()},cancel:function(){}})}
function deleteAllObject(){$.confirm({text:langjs.DELETE_ALL_ITEM_MESSAGE,confirm:function(){var a=angular.element(document.getElementById("designer-controller")).scope();a.canvas.clear();a.closePopover();a.updateCurrentLayerAfterDelete();$("#gesture .menu_gesture").hasClass("open")&&$("#gesture .menu_gesture .m-center").triggerHandler("click");$("#layer").hasClass("open")&&$("#layer").triggerHandler("click");"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()},cancel:function(){}})}
fabric.Canvas.prototype._handleCursorAndEvent=function(a,b){this._setCursorFromEvent(a,b);var e=this;setTimeout(function(){e._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})};fabric.Canvas.prototype._getRotatedCornerCursor=function(a,b){if("tr"==a)return"copy";if("tl"==a)return"pointer";if("bl"==a)return"cell";var e=Math.round(b.getAngle()%360/45);0>e&&(e+=8);e+={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7}[a];return this.cursorMap[e%8]};
fabric.CustomImage=fabric.util.createClass(fabric.Image,{type:"custom-image",initialize:function(a,b){this.callSuper("initialize",a,b);b&&this.set("origin_src",b.origin_src)},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{origin_src:this.origin_src})}});fabric.CustomImage.fromObject=function(a,b){fabric.util.loadImage(a.src,function(e){b&&b(new fabric.CustomImage(e,a))})};fabric.CustomImage.async=!0;
function addFontFaceToFaric(a,b,e){a=a.replace(/\s/g,"+");"google"==b?fabric.googleFonts[a]="https://fonts.googleapis.com/css?family="+a:(base64=base64Encode(getBinary(e)),console.log(base64),fabric.fontPaths[a]=base64)}var _window={width:500,height:500};function calcCanvasWidth(){var a=$(window).width(),b=$(window).height();_window.width=a>b-120?b-120:a;return _window.width}var app=angular.module("imgpreload",[]);
$(window.parent).on("resize",function(){var a=angular.element(document.getElementById("designer-controller")).scope();a.resetDimension();"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()});
app.directive("spinnerOnLoad",function(){return{restrict:"A",link:function(a,b){b.on("load",function(){b.removeClass("spinner-hide");b.addClass("spinner-show");b.parent().removeAttr("width");b.parent().find("span").remove()});a.$watch("ngSrc",function(){b.addClass("spinner-hide");b.parent().append('<span class="spinner"></span>')})}}}).directive("fontOnLoad",function(){return{restrict:"A",link:function(a,b){var e=setInterval(function(){var a=b.find(".nbdesigner_font_name").data("font");isFontAvailable(a)&&
(b.find(".spinner").remove(),b.removeAttr("width"),b.css("opacity",1),clearInterval(e))},100),g=setTimeout(function(){var a=b.find(".nbdesigner_font_name").data("font");isFontAvailable(a)&&clearInterval(g);isFontAvailable(a)||(clearInterval(e),b.remove())},5E3);b.append('<span class="spinner"></span>')}}});
angular.module("app").controller("DesignerController",function(a,b,e,g,h,d,k,l,r,t,u,n){a.canvas=null;a.designerWidth=calcCanvasWidth();a.designerHeight=calcCanvasWidth();a.modeMobile=!1;var p=$(window).width();768>p&&(a.modeMobile=!0);a.offset=p/2-a.designerWidth/2;a.editableItem=null;a.editableObject=null;a.currentVariant={};a.currentVariant.info={};a.varaints={};a.varaints.frames={};a.varaints.areaDesign={};a.varaints.areaParams={};a.currentVariant.orientationActive="frame_0";a.currentVariant.orientationBefore=
"frame_0";a.currentVariant.index=0;a.layers={};a.currentLayers=[];a.currentLayerActive=1;a.currentColor="FFFFFF";a.editMode="none";a.borderColor="#000000";a.colorOptional="cc324b";a.colorStrokeOptional="394264";a.background="f98332";a.lockProportion=!0;a.lineHeight=1;a.fontSize=30;a.loaded=0;a.shadow={};a.shadow.x=0;a.shadow.y=0;a.shadow.blur=0;a.shadow.alpha=1;a.shadow.color="394264";a.loaded=0;a.zoom=1;a.settings={};a.Popover="none";a.currentFont={};a.currentFont.name="Arial";a.pop={};a.pop.type=
"";a.pop.text="none";a.pop.art="none";a.pop.clipArt="none";a.pop.qrcode="none";a.pop.draw="none";a.canvases={};a.dataCustomerDesign={};a.editable={};a._=_;a.uploadURL=[];a.file=[];a.loading=!1;a.currentCateFont="Font Categories";a.contentText="Text Here";a.designScale=calcCanvasWidth()/300;a.scale={};a.rateConvertCm2Px=37.8;a.currentScale="1";a.iid="images";a.qrCodeContent="http://example.com/";a.imgPageSize=10;a.artPageSize=10;a.artPageSizes=[];a.imgCurrentPage=0;a.artCat=[];a.arts=[];a.curentCatArt=
"0";a.currentCatArtName="Categories";a.editable.paths=[];a.pathColor=[];a.countArt=0;a.fontPageSize=10;a.fontPageSizes=[];a.fontCat=[];a.fonts=[];a.AllFonts=[];a.google_font=[];a.googleFont=[];a.customFont=[];a.googleFontPageSize=10;a.adminTemplatePageSize=8;a.curentCatFont="0";a.currentCatFontName="Categories";a.countFont=0;a.enableGroup=!1;a.colorBrush="cc324b";a.brushShadowWidth=1;a.brushWidth=1;a.brushOpacity=1;a.brushAngle=0;a.colorShape="f98332";a.shapeMode=!1;a.currentPreview=od_mainURL+"images/default.png";
a.processing=100;a.currentPathCrop=listPath.path_crop;a.patterns=[];a.patternPageSize=10;a.imageFromUrl="";a.fontCollection={};a.currentFontCollection=[];a.ajustmentScale=1;a.ajustmentOrientationScale=[];a.flagChangeOrientation=[];a.ignoreLocalDesign=!1;a.adminListTemplate=[];a.backgroundId=0;a.statusWebcam=!1;a.onLoadProduct=!1;a.resetDimension=function(){a.designerWidth=calcCanvasWidth();a.designerHeight=calcCanvasWidth();a.modeMobile=!1;var c=a.designScale;a.designScale=calcCanvasWidth()/300;var b=
$(window).width();768>b&&(a.modeMobile=!0);a.offset=b/2-a.designerWidth/2;a.zoomCanvas();b=a.currentVariant.orientationActive.substring(6);a.ajustmentOrientationScale[b]=a.designScale;a.resizeDesign(a.designScale,c)};a.ajustAfterAddItem=function(c){var b=a.canvas.getObjects().length-1;a.canvas.setActiveObject(a.canvas.item(b));a.canvas.item(a.editableItem).centerH();a.canvas.item(a.editableItem).centerV();a.canvas.item(a.editableItem).setCoords();a.drawCanvas();a.addLayers(a.canvas.getActiveObject(),
c,b)};a.addText=function(){a.disableDrawMode();a.showPopover("text");a.zoom=1;a.zoomCanvas();var c=new fabric.Text(a.contentText,{left:100,top:10,fill:"#cc324b",fontFamily:"Arial",radius:50,fontSize:30,textAlign:"center",spacing:0});a.canvas.add(c);a.ajustAfterAddItem("text")};a.ChangeText=function(){if(null!=a.editableItem){a.canvas.item(a.editableItem).setText(a.editable.text);var c=a.canvas.item(a.editableItem).get("type");a.addLayers(a.canvas.item(a.editableItem),c,a.editableItem);a.drawCanvas()}};
a.changeFont=function(c){if(null!=a.editableItem){var b=l(function(){var m;m=c.alias?c.alias:c.name;isFontAvailable(m)&&(a.currentFont=c,a.canvas.item(a.editableItem).setFontFamily(m),a.canvas.item(a.editableItem).set("fontName",m),a.canvas.getObjects(),a.canvas.setActiveObject(a.canvas.item(a.editableItem)),a.canvas.item(a.editableItem).setCoords(),a.drawCanvas(),l.cancel(b))},100);a.currentFontCollection[a.editableItem]=c;jQuery("#dg-fonts").modal("hide")}};a.addTeam=function(){a.showPopover("team")};
a.closePopover=function(){a.Popover="none"};a.showPopover=function(c){a.pop.type=c;a.pop.text="none";a.pop.art="none";a.pop.qrcode="none";a.pop.clipArt="none";a.pop.draw="none";a.Popover="block";switch(c){case "text":a.pop.text="block";break;case "art":a.pop.art="block";break;case "qrcode":a.pop.qrcode="block";break;case "clipArt":a.pop.clipArt="block";break;case "draw":a.pop.draw="block";break;default:a.pop.text="none",a.pop.art="none",a.pop.qrcode="none",a.pop.clipArt="none",a.pop.draw="none"}};
a.drawCanvas=function(){a.canvas.renderAll()};a.changeColor=function(c){null!=a.editableItem&&(c="#"+c,a.canvas.item(a.editableItem).setFill(c),a.editable.fill=c,a.drawCanvas())};a.changeStroke=function(c,b){null!=a.editableItem&&(c&&(a.editable.stroke="#"+c,a.canvas.item(a.editableItem).setStroke(a.editable.stroke)),b&&a.canvas.item(a.editableItem).setStrokeWidth(b),a.drawCanvas())};a.toggleItalic=function(){null!=a.editableItem&&(a.editable.italic?(a.editable.italic=!1,a.canvas.item(a.editableItem).setFontStyle("normal")):
(a.editable.italic=!0,a.canvas.item(a.editableItem).setFontStyle("italic")),a.drawCanvas())};a.toggleBold=function(){null!=a.editableItem&&(a.editable.bold?(a.editable.bold=!1,a.canvas.item(a.editableItem).setFontWeight("normal")):(a.editable.bold=!0,a.canvas.item(a.editableItem).setFontWeight("bold")),a.drawCanvas())};a.toggleTextDecoration=function(c){null!=a.editableItem&&(a.editable.textDecoration==c?(a.editable.textDecoration="",a.canvas.item(a.editableItem).setTextDecoration("")):(a.editable.textDecoration=
c,a.canvas.item(a.editableItem).setTextDecoration(c)),a.drawCanvas())};a.changeShadow=function(){if(null!=a.editableItem){var c=hexToRGB("#"+a.shadow.color),c="rgba("+c.r+", "+c.g+", "+c.b+", "+a.shadow.alpha+") "+a.shadow.x+"px "+a.shadow.y+"px "+a.shadow.blur+"px";a.canvas.item(a.editableItem).setShadow(c);a.drawCanvas()}};a.removeShadow=function(){null!=a.editableItem&&(a.canvas.item(a.editableItem).setShadow(""),a.drawCanvas())};a.flipHorizontal=function(){null!=a.canvas.getActiveObject()&&(a.canvas.item(a.editableItem).toggle("flipY"),
a.canvas.item(a.editableItem).setCoords(),a.drawCanvas())};a.flipVertical=function(){null!=a.canvas.getActiveObject()&&(a.canvas.item(a.editableItem).toggle("flipX"),a.canvas.item(a.editableItem).setCoords(),a.drawCanvas())};a.setHorizontalCenter=function(){null!=a.canvas.getActiveObject()&&(a.canvas.item(a.editableItem).centerH(),a.canvas.item(a.editableItem).setCoords(),a.drawCanvas())};a.setVerticalCenter=function(){null!=a.canvas.getActiveObject()&&(a.canvas.item(a.editableItem).centerV(),a.canvas.item(a.editableItem).setCoords(),
a.drawCanvas())};a.ShiftLeft=function(){if(null!=a.canvas.getActiveObject()){var c=a.canvas.width/100,b=a.canvas.item(a.editableItem).left;a.canvas.item(a.editableItem).set("left",b-c);a.canvas.item(a.editableItem).setCoords();a.drawCanvas()}};a.ShiftRight=function(){if(null!=a.canvas.getActiveObject()){var c=a.canvas.width/100,b=a.canvas.item(a.editableItem).left;a.canvas.item(a.editableItem).set("left",b+c);a.canvas.item(a.editableItem).setCoords();a.drawCanvas()}};a.ShiftUp=function(){if(null!=
a.canvas.getActiveObject()){var c=a.canvas.height/100,b=a.canvas.item(a.editableItem).top;a.canvas.item(a.editableItem).set("top",b-c);a.canvas.item(a.editableItem).setCoords();a.drawCanvas()}};a.ShiftDown=function(){if(null!=a.canvas.getActiveObject()){var c=a.canvas.height/100,b=a.canvas.item(a.editableItem).top;a.canvas.item(a.editableItem).set("top",b+c);a.canvas.item(a.editableItem).setCoords();a.drawCanvas()}};a.unlockProportion=function(){null!=a.editableItem&&(a.canvas.setActiveObject(a.canvas.item(a.editableItem)),
a.drawCanvas())};a.rotateText=function(c){null!=a.editableItem&&(c?(360<c&&(c-=360),0>c&&(c+=360),a.canvas.item(a.editableItem).setAngle(c)):a.canvas.item(a.editableItem).setAngle(0),a.drawCanvas())};a.deleteAllItem=function(){deleteAllObject();a.drawCanvas()};a.align=function(c){null!=a.editableItem&&(a.editable.textAlign=c,a.canvas.item(a.editableItem).setTextAlign(c),a.drawCanvas())};a.setOpacity=function(c){null!=a.editableItem&&(c=1-c,a.canvas.item(a.editableItem).set({opacity:c}),a.drawCanvas())};
a.setBackground=function(c){null!=a.editableItem&&(c?a.canvas.item(a.editableItem).setTextBackgroundColor(""):a.canvas.item(a.editableItem).setTextBackgroundColor("#"+a.background),a.drawCanvas())};a.setLineHeight=function(){null!=a.editableItem&&(a.canvas.item(a.editableItem).setLineHeight(a.lineHeight),a.drawCanvas())};a.changeCurve=function(c){if(null!=a.editableItem){var b=a.editableItem,d=a.canvas.item(b).getText();if("curvedText"==a.canvas.item(b).get("type"))a.canvas.item(b).set({radius:2.5*
(100-c)});else{var b=a.canvas.item(b),e={};e.left=b.left;e.top=b.top;e.textAlign=b.textAlign;e.fill=b.fill;e.angle=b.angle;e.textBackgroundColor=b.textBackgroundColor;e.stroke=b.stroke;e.fontSize=b.fontSize;e.fontFamily=b.fontFamily;e.lineHeight=b.lineHeight;e.height=b.height;e.width=b.width;e.radius=2.5*(100-c);c=new fabric.CurvedText(d,e);a.canvas.remove(a.canvas.getActiveObject());a.drawCanvas();a.canvas.add(c);b=a.canvas.getObjects().length-1;a.canvas.setActiveObject(a.canvas.item(b));a.canvas.item(a.editableItem).centerH();
a.canvas.item(a.editableItem).centerV();a.canvas.item(a.editableItem).setCoords()}a.drawCanvas()}};a.setSpacing=function(){null!=a.editableItem&&(a.canvas.item(a.editableItem).set("spacing",a.editable.spacing),a.drawCanvas())};a.changeEffect=function(c){null!=a.editableItem&&(a.canvas.item(a.editableItem).set("effect",c),a.drawCanvas())};a.reverseCurve=function(){if(null!=a.editableItem){var c=angular.element(document.querySelector("input#curve_reverse")).is(":checked");a.canvas.item(a.editableItem).set("reverse",
c);a.drawCanvas()}};a.changePattern=function(c){c=a.ajustUrl(c);changePattern(c);jQuery("#dg-pattern").modal("hide");a.drawCanvas()};a.ajustUrl=function(a){return od_mainURL+a};a.loadPattern=function(){0<a.patterns.length||b.fn(function(c){"1"==c.flag?a.patterns=c.data.patterns:console.log("Error! Try again!")})};a.changePatternRepeat=function(c){a.canvas.item(a.editableItem).fill.repeat=c;a.drawCanvas()};a.setFontSize=function(){null!=a.editableItem&&(a.canvas.item(a.editableItem).setFontSize(a.fontSize),
a.drawCanvas())};a.setGradient=function(){if(null!=a.editableItem){var c=createGradient(),b;b=angular.element(document.querySelector('input[name="gradient_direction"]:checked')).val();var d=a.canvas.item(a.editableItem).getWidth(),e=a.canvas.item(a.editableItem).getHeight();"h"==b?a.canvas.item(a.editableItem).setGradient("fill",{type:"linear",x1:-d,y1:0,x2:0,y2:0,colorStops:c}):a.canvas.item(a.editableItem).setGradient("fill",{type:"linear",x1:0,y1:0,x2:0,y2:e/2,colorStops:c});a.drawCanvas()}};a.zoomOut=
function(){a.zoom-=.1;1>=a.zoom&&(a.zoom=1);a.canvas.setZoom(a.zoom);a.drawCanvas();a.zoomCanvas()};a.zoomIn=function(){a.zoom+=.1;2<=a.zoom&&(a.zoom=2);a.zoomCanvas()};a.scaleItem=function(c){var b=a.canvas.getActiveObject();if(b){var d=b.scaleX,e=b.scaleY,h=b.left,g=b.top,k=b.width*d,l=b.height*e;c="+"==c?1.1:.9;b.scaleX=d*c;b.scaleY=e*c;b.left=h+k/2-k*c/2;b.top=g+l/2-l*c/2;b.setCoords();a.drawCanvas()}};a.zoomCanvas=function(){a.canvas.setDimensions({width:a.zoom*a.currentVariant.designArea.area_design_width*
a.designScale,height:a.zoom*a.currentVariant.designArea.area_design_height*a.designScale});a.canvas.calcOffset();a.canvas.setZoom(a.zoom);a.drawCanvas()};a.loadProduct=function(c,b){e.getProduct(c,b).then(function(c){a.onLoadProduct=!1;window.parent.NBDESIGNERPRODUCT.nbdesigner_ready();a.varaints.areaDesign=c.product;a.rateConvertCm2Px=Math.round(a.rateConvertCm2Px*(parseInt(c.dpi)/96)*10)/10;if("object"==toType(c.design))a.canvases=c.design,a.changeOrientation(),a.loaded=100,hide_indicator();else{var b=
"p_"+product_id,d="c_"+product_id;"object"!==toType(g.get(b))||""!=OD_task||a.ignoreLocalDesign?"object"===toType(c.admindesign)?(a.canvases=c.admindesign,"object"===toType(c.config)&&(a.ajustmentScale=c.config.scale),"array"===toType(c.fonts)&&a.loadAdminDesignFont(c.fonts,window.parent.nbds_frontend.font_url)):(a.changeOrientation(),a.loaded=100,hide_indicator()):(a.canvases=g.get(b),"object"===toType(g.get(d))&&(c=g.get(d),a.ajustmentScale=c.scale,a.loadAdminDesignFont(c.font_used,c.furl)))}})};
a.loadAdminListDesign=function(){_.size(a.adminListTemplate)||(show_indicator(),n.getDesign(product_id).then(function(c){"success"==c.mes?_.each(c.data,function(c,b){a.adminListTemplate.push({src:c[0],id:b})}):alert("Oops! Try again");hide_indicator()}));$("#nbdesigner-list-template").addClass("open");$("#design-editor-container").removeClass("open")};a.loadExtraAdminDesign=function(c){a.loaded=0;a.ignoreLocalDesign=!0;show_indicator();$("#dg-expand-feature").modal("hide");a.canvas.clear();a.loadProduct(c,
0)};a.loadAdminDesignFont=function(c,b){_.each(c,function(a){if("google"==a.type){var c=a.name,c=c.replace(" ","+");jQuery("head").append("<link href='https://fonts.googleapis.com/css?family="+c+"' rel='stylesheet' type='text/css'>")}else isFontAvailable(a.name)||(c=b+a.name+"."+a.ext,a="<style type='text/css'>"+("@font-face {font-family: '"+a.name+"';"),a=a+"src: local('\u263a'),"+("url('"+c+"') format('truetype')")+"}</style>",jQuery("head").append(a))});var d=[],m=0,e=l(function(){var b=!0;m+=
100;_.each(c,function(a,c){isFontAvailable(a.name)?d[c]=!0:d[c]=!1});_.each(d,function(a){a||(b=!1)});if(b||3E3<m)a.changeOrientation(),a.loaded=100,hide_indicator(),l.cancel(e)},100)};a.loadLanguage=function(c){var b=!1;null==c?(c="en",""!=NBDESIGNCONFIG.lang_code&&(c=NBDESIGNCONFIG.lang_code),b=!0):(show_indicator(),$(".translate-switch").removeClass("open"));u.getLang(c).then(function(c){"success"==c.mes&&(a.langs=c.langs,_.each(a.langs,function(c,b){a.langs[b]=c.replace(/\\/g,"")}),a.langCategories=
c.cat,a.currentCatLang=c.code,langjs.DELETE_ITEM_MESSAGE=a.langs.DELETE_ITEM_MESSAGE?a.langs.DELETE_ITEM_MESSAGE:"Are you sure you want to delete this item?",langjs.DELETE_ALL_ITEM_MESSAGE=a.langs.DELETE_ALL_ITEM_MESSAGE?a.langs.DELETE_ALL_ITEM_MESSAGE:"Are you sure you want to delete all layers?",langjs.LAYER_IMAGE=a.langs.IMAGE?a.langs.IMAGE:"Image",langjs.LAYER_GROUP=a.langs.GROUP?a.langs.GROUP:"Group",langjs.LAYER_PATH=a.langs.PATH?a.langs.PATH:"Path",langjs.LAYER_RECTANGLE=a.langs.RECTANGLE?
a.langs.RECTANGLE:"Rectangle",langjs.LAYER_CIRCLE=a.langs.CIRCLE?a.langs.CIRCLE:"Circle",langjs.LAYER_TRIANGLE=a.langs.TRIANGLE?a.langs.TRIANGLE:"Triangle",langjs.LAYER_LINE=a.langs.LINE?a.langs.LINE:"Line",langjs.LAYER_POLYGON=a.langs.POLYGON?a.langs.POLYGON:"Polygon");b?a.loaded=70:hide_indicator()})};a.loadFont=function(c){0<a.fontCat.length||0<a.fonts.length||h.fn(function(c){"1"==c.flag?("array"==toType(c.cat)&&(a.fontCat=c.cat),"array"==toType(c.fonts)&&(a.fonts=c.fonts,a.getAmountFont(a.fonts,
a.curentCatFont),a.customFont=JSON.parse(JSON.stringify(c.fonts))),"array"==toType(c.google_font)&&(a.google_font=c.google_font,a.googleFont=JSON.parse(JSON.stringify(c.google_font))),a.AllFonts=a.fonts,a.changeFontPageSize(!0)):console.log("Error! Try again!")})};a.loadGoogleFont=function(){a.changeFontCat({id:"99",name:"Google Font"});a.changeFontPageSize(!0)};a.changeFontPageSize=function(c){var b=0,d=[],e="";c||(b=a.fontPageSize,a.fontPageSize+=10);"99"==a.curentCatFont?(d=a.googleFont,c=b+10,
d.length<c-1&&(c=d.length+1),b=d.slice(b,c),_.each(b,function(a,c){var b=a.name,b=b.split(" ").join("+");e=e+b+"|"}),e=e.slice(0,e.length-1),$("head").append("<link href='https://fonts.googleapis.com/css?family="+e+"' rel='stylesheet' type='text/css'>")):(d=a.customFont,d=a.filterCat(d,a.curentCatFont),c=b+10,d.length<c-1&&(c=d.length+1),b=d.slice(b,c),_.each(b,function(a,c){if(!isFontAvailable(a.alias)){var b;b="<style type='text/css'>"+("@font-face {font-family: '"+a.alias+"';");b=b+"src: local('\u263a'),"+
("url('"+a.url+"') format('truetype')");b+="}</style>";jQuery("head").append(b)}}))};a.filterCat=function(a,b){var c=[];_.each(a,function(a,d){0==a.cat.length&&(a.cat=["0"]);0<=$.inArray(b,a.cat)&&c.push(a)});return c};a.changeFontCat=function(c){var b=!1;a.AllFonts="99"==c.id?a.google_font:a.fonts;a.fontPageSizes[a.curentCatFont]=a.fontPageSize;a.fontPageSizes[c.id]?a.fontPageSize=a.fontPageSizes[c.id]:(b=!0,a.fontPageSize=10);a.currentCatFontName=c.name;a.curentCatFont=c.id;"99"==c.id?a.countFont=
a.google_font.length:(a.getAmountFont(a.fonts,a.curentCatFont),b&&a.changeFontPageSize(b));$("#nbdesigner_font_container").stop().animate({scrollTop:0},400)};a.loadArt=function(){0<a.artCat.length||0<a.arts.length||(a.disableDrawMode(),d.fn(function(c){"1"==c.flag?("array"==toType(c.cat)&&(a.artCat=c.cat),"array"==toType(c.arts)&&(a.arts=c.arts,a.getAmountArt(a.arts,a.curentCatArt))):console.log("Error! Try again!")}))};a.changeArtCat=function(c){a.artPageSizes[a.curentCatArt]=a.artPageSize;a.artPageSize=
a.artPageSizes[c.id]?a.artPageSizes[c.id]:10;a.currentCatArtName=c.name;a.curentCatArt=c.id;a.getAmountArt(a.arts,a.curentCatArt);$("#nbdesigner_art_container").stop().animate({scrollTop:0},400)};a.getAmountArt=function(c,b){a.countArt=0;_.each(c,function(c,d){0<=$.inArray(b,c.cat)&&a.countArt++})};a.getAmountFont=function(c,b){a.countFont=0;_.each(c,function(c,d){0<=$.inArray(b,c.cat)&&a.countFont++})};a.addArt=function(c){fabric.loadSVGFromURL(c.url,function(c,b){a.canvas.add((new fabric.PathGroup(c,
b)).set({left:100,top:100}));a.canvas.setActiveObject(a.canvas.item(a.canvas.getObjects().length-1));var d=.9*a.canvas.width,e=.9*a.canvas.height,m=d;b.width<d&&(m=b.width);d=m/b.width*b.height;d>e&&(d=e,m=d/b.height*b.width);e=a.canvas.getActiveObject();_.each(e.paths,function(a,c){});a.canvas.getActiveObject().set({scaleX:m/b.width,scaleY:d/b.height}).center().setCoords();m=a.canvas.getObjects().length-1;a.addLayers(a.canvas.getActiveObject(),"path-group",m);jQuery("#dg-cliparts").modal("hide");
a.canvas.setActiveObject(a.canvas.item(m));a.drawCanvas()})};a.showPathConfig=function(){if(null==a.editableItem)a.editable._paths=[],a.editable.paths=[];else{var c=a.canvas.item(a.editableItem),b=c.get("type");if("path-group"==b||"path"==b)a.editable._paths=c.paths,a.editable.paths=a.getColorPath(c.paths)}};a.getColorPath=function(c){var b=[];_.each(c,function(c,d){if("string"==toType(c.fill)&&"#"==c.fill.charAt(0)){var e=c.fill,e=e.slice(1,e.length);b.push({fill:e,key:d});a.pathColor[d]=e}else if("string"==
toType(c.fill)&&"r"==c.fill.charAt(0)){var e=c.fill.slice(4,c.fill.length-1).split(","),m=!0;"0"==e[0]&&"0"==e[1]&&"0"==e[2]&&e[3]&&(m=!1);if(m){var m=parseInt(e[0],16),h=parseInt(e[1],16),e=parseInt(e[2],16),e=m+""+h+""+e;b.push({fill:e,key:d});a.pathColor[d]=e}}});return b};a.getColorCode=function(a){return"#"+a};a.updatePathColor=function(c){"path-group"==a.editable.type&&(a.editable._paths[c.key].fill="#"+a.pathColor[c.key]);a.drawCanvas()};a.showGrid=function(){};a.deleteLayer=function(a){deleteObject(a.index)};
a.activeLayer=function(c){a.canvas.item(c.index).get("selectable")&&(a.canvas.setActiveObject(a.canvas.item(c.index)),a.drawCanvas())};a.parseObject=function(a){a=a.replace(/'/g,'"');return JSON.parse(a)};a.changeVariant=function(){};a.changeOrientation=function(c){var b=!1;null==c&&(c={name:"frame_0",id:0},b=!0);a.currentVariant.orientationBefore=a.currentVariant.orientationActive;b||a.saveDesign(a.currentVariant.orientationBefore);a.currentVariant.orientationActive=c.name;var d=0;a.currentVariant.info=
[];_.each(a.varaints.areaDesign,function(c,b){a.currentVariant.info[b]={source:c,name:"frame_"+b,v_index:a.currentVariant.index,id:b};d++});var e=[{img_src:a.currentVariant.info[c.id].source.img_src,img_src_left:a.currentVariant.info[c.id].source.img_src_left,img_src_top:a.currentVariant.info[c.id].source.img_src_top,img_src_width:a.currentVariant.info[c.id].source.img_src_width,img_src_height:a.currentVariant.info[c.id].source.img_src_height}];a.currentVariant.numberFrame=d;a.currentVariant.activeImages=
e;a.currentVariant.designArea=a.varaints.areaDesign[c.id];var e=a.currentVariant.designArea.area_design_width*a.designScale,h=a.currentVariant.designArea.area_design_height*a.designScale;a.scale[c.name]=a.currentVariant.info[c.id].source.real_width*a.rateConvertCm2Px/e;a.currentScale=a.scale[c.name];a.canvas.setDimensions({width:e,height:h});b||a.updateCurrentLayer();angular.isDefined(a.canvases[c.name])?a.canvas.loadFromJSON(a.canvases[c.name],function(){applyImageFilters();a.canvas.renderAll();
a.updateCurrentLayerAfterDelete();angular.isUndefined(a.flagChangeOrientation[c.id])?(a.resizeDesign(a.designScale,a.ajustmentScale),a.flagChangeOrientation[c.id]=1):a.ignoreLocalDesign?a.resizeDesign(a.designScale,a.ajustmentScale):a.ajustmentOrientationScale[c.id]!=a.designScale&&a.resizeDesign(a.designScale,a.ajustmentOrientationScale[c.id]);a.ajustmentOrientationScale[c.id]=a.designScale}):a.canvas.clear();angular.isDefined(a.fontCollection[c.name])&&(a.currentFontCollection=JSON.parse(a.fontCollection[c.name]));
a.zoom=1;a.zoomCanvas();a.drawCanvas();a.canvas.isDrawingMode=!1};a.resizeDesign=function(c,b){var d=c/b;a.canvas.forEachObject(function(a){var c=a.scaleY*d,b=a.left*d,e=a.top*d;a.scaleX*=d;a.scaleY=c;a.left=b;a.top=e});a.canvas.calcOffset();a.drawCanvas()};a.saveDesign=function(c){null==c&&(c=a.currentVariant.orientationActive);a.zoom=1;a.zoomCanvas();a.drawCanvas();var b=canvas.toJSON();if(a.modeMobile){var d=a.currentVariant.designArea.area_design_width*a.designScale,e=a.currentVariant.designArea.area_design_height*
a.designScale;a.zoom=d>e?1E3<d*a.currentScale?1E3/d:a.currentScale:1E3<e*a.currentScale?1E3/e:a.currentScale}else a.zoom=a.currentScale;a.zoomCanvas();a.drawCanvas();d=canvas.deactivateAll().toDataURL();a.canvases[c]=b;a.fontCollection[c]=JSON.stringify(a.currentFontCollection);a.dataCustomerDesign[c]=d;a.currentPreview=d;a.zoom=1;a.zoomCanvas();a.drawCanvas();c="p_"+product_id;b="c_"+product_id;config={};config.scale=a.designScale;config.furl=window.parent.nbds_frontend.font_url;config.font_used=
a.filterFontUsed();try{g.set(c,a.canvases),g.set(b,config)}catch(v){g.clearAll(),g.set(c,a.canvases),g.set(b,config)}};a.usedFont=function(a){var c=[];a.forEachObject(function(a){"i-text"!==a.type&&"text"!==a.type&&"curvedText"!==a.type||c.push(a.get("fontName"))});return c};a.filterFontUsed=function(){var c=[];_.forEach(a.fontCollection,function(a){a=JSON.parse(a);_.each(a,function(a){"object"==toType(a)&&("99"==a.cat[0]?c.push({type:"google",name:a.name}):c.push({type:"custom",name:a.alias,ext:a.type}))})});
return c};a.preview=function(){a.saveDesign()};a.storeDesign=function(){a.saveDesign();var c=a.filterFontUsed(),b={};b.scale=a.designScale;NBDESIGNERCART.upload_design(a.dataCustomerDesign,a.canvases,c,b)};a.storeDesign1=function(){show_indicator();g.set("design",a.canvases);a.currentUser="";var c={},b={};a.saveDesign();a.zoom=5;a.zoomCanvas();var d=a.currentVariant.orientationActive;_.each(a.canvases,function(d,e){e="frame_1";a.changeOrientation({name:e});c[e]=a.usedFont(a.canvas);/MSIE/.test(navigator.userAgent);
b[e]=a.canvas.deactivateAll().toSVG()});a.changeOrientation({name:d});console.log(a.canvas.deactivateAll().toSVG());UserService.getUserId().then(function(d){a.currentUser=d;if(""!==a.currentUser||0<a.currentUser)var e=/MSIE/.test(navigator.userAgent)?"type=saveDesignIE":"type=saveDesign";0!=a.currentUser&&""!=a.currentUser&&StoreService.postData(c,b,e);a.zoom=1;a.zoomCanvas();hide_indicator()})};a.toggleImportArea=function(){$("#design-editor-container").toggleClass("open");$("#nbdesigner-list-template").removeClass("open");
$("#nbdesigner-list-template").stop().animate({scrollTop:0},400)};a.exportDesign=function(){a.saveDesign();var c=JSON.stringify(a.canvases),b=document.createElement("a");b.setAttribute("href","data:text/plain;charset=utf-u,"+c);b.setAttribute("download","design.json");b.click()};a.importDesign=function(){var c=JSON.parse($("#design-json-content").val());"object"===toType(c)&&(show_indicator(),a.canvases=c,a.changeOrientation(),hide_indicator());$("#dg-expand-feature").modal("hide")};a.resetAdminDesign=
function(){a.loaded=0;a.ignoreLocalDesign=!0;show_indicator();$("#dg-expand-feature").modal("hide");a.canvas.clear();a.loadProduct("",0)};a.calcLeft=function(c){if(angular.isDefined(c)){var b=a.designerWidth/2;c*=a.designScale;return b-(b-c)*a.zoom}};a.calcWidthThumb=function(a){return 4>a?a:4};a.calcDimension=function(c){c=a.zoom*c*a.designScale;return c+"px"};a.addLayers=function(c,b,d){var e={};if("text"===b||"i-text"===b||"curvedText"===b)e=c.text,20<e.length&&(e=e.substring(0,19)),e={name:e,
type:"text",src:"",index:d};"image"===b&&(e={name:langjs.LAYER_IMAGE,type:"image",src:c.getSvgSrc(),index:d});"custom-image"==b&&(e={name:langjs.LAYER_IMAGE,type:"image",src:c.origin_src,index:d});"path-group"===b&&(e={name:"SVG",type:"path-group",src:od_mainURL+"images/svg.png",index:d});"group"===b&&(e={name:langjs.LAYER_GROUP,type:"path-group",src:od_mainURL+"images/svg.png",index:d});"path"===b&&(e={name:langjs.LAYER_PATH,type:"path",src:od_mainURL+"images/path.png",index:d});"rect"===b&&(e={name:langjs.LAYER_RECTANGLE,
type:"rect",src:od_mainURL+"images/mark/mark_12.svg",index:d});"circle"===b&&(e={name:langjs.LAYER_CIRCLE,type:"circle",src:od_mainURL+"images/mark/mark_03.svg",index:d});"triangle"===b&&(e={name:langjs.LAYER_TRIANGLE,type:"triangle",src:od_mainURL+"images/mark/mark_13.svg",index:d});"line"===b&&(e={name:langjs.LAYER_LINE,type:"line",src:od_mainURL+"images/path.png",index:d});"polygon"===b&&(e={name:langjs.LAYER_POLYGON,type:"polygon",src:od_mainURL+"images/mark/mark_11.svg",index:d});angular.isUndefined(a.layers[a.currentVariant.orientationActive])&&
(a.layers[a.currentVariant.orientationActive]=[]);a.layers[a.currentVariant.orientationActive][d]=e;a.updateCurrentLayer()};a.sortLayer=function(c,b){var d=a.canvas.getObjects().length;if(!angular.isUndefined(c)&&!angular.isUndefined(b)){if(c<b){for(var e=0;e<c;e++)a.bringToFront(0);for(e=0;e<b-c;e++)a.bringToFront(1);for(e=b;e<d;e++)a.bringToFront(0)}else{for(e=0;e<b;e++)a.bringToFront(0);a.bringToFront(c-b);for(e=0;e<d-b-1;e++)a.bringToFront(0)}a.updateCurrentLayerAfterDelete();a.canvas.deactivateAll();
a.canvas.setActiveObject(a.canvas.item(b))}};a.bringToFront=function(b){a.canvas.item(b).bringToFront()};a.setStackPosition=function(b){var c=canvas.getActiveObject();if(null!=c){switch(b){case "bringToFront":c.bringToFront();break;case "bringForward":c.bringForward();break;case "sendBackwards":c.sendBackwards();break;case "sendToBack":c.sendToBack()}a.canvas.setActiveObject(c);a.updateCurrentLayerAfterDelete()}};a.updateCurrentLayerAfterDelete=function(){var b=a.canvas.getObjects().length;a.layers[a.currentVariant.orientationActive]=
[];if(0===b)a.layers[a.currentVariant.orientationActive]=[],a.currentLayers=[];else for(var d=0;d<b;d++){var e=a.canvas.item(d).get("type");a.addLayers(a.canvas.item(d),e,d)}};a.updateCurrentLayer=function(){a.currentLayers=a.layers[a.currentVariant.orientationActive]};a.getQrCode=function(){k.fn(a.qrCodeContent,function(b){if("1"==b.flag){var c='<img src="'+b.src+'" class="qr_image shadow hover-shadow" onclick="NBDESIGNERFUNC.addQrImage(\''+b.src+"')\" spinner-on-load />";$("#qrcode-img").html("");
$("#qrcode-img").append(c);a.uploadURL.push(b.src);g.set(a.iid,a.uploadURL)}else alert("Error! Try again!")})};a.showDrawConfig=function(){showConfig();a.showPopover("draw")};a.changeDrawMode=function(){a.canvas.isDrawingMode=!0;a.freeDrawingMode="Pencil";a.setDrawingLineColor(a.colorBrush);a.setDrawingLineWidth(a.brushWidth);a.setDrawingLineShadowWidth(a.brushShadowWidth);a.setDrawingLineOpacity(a.brushOpacity)};a.disableDrawMode=function(){a.canvas.isDrawingMode=!1};a.setDrawingMode=function(b){a.canvas.isDrawingMode=
!0;a.freeDrawingMode=b;a.canvas.freeDrawingBrush="hline"===b?a.vLinePatternBrush:"vline"===b?a.hLinePatternBrush:"square"===b?a.squarePatternBrush:"diamond"===b?a.diamondPatternBrush:"texture"===b?a.texturePatternBrush:new fabric[b+"Brush"](a.canvas);jQuery("#brush_width").slider("value",0);jQuery("#brush_shadow_width").slider("value",0);jQuery("#show_popover_option_draw").hasClass("open")||jQuery("#show_popover_option_draw").triggerHandler("click")};a.setDrawingLineColor=function(b){a.canvas.freeDrawingBrush&&
(a.canvas.freeDrawingBrush.color="#"+b)};a.setDrawingLineWidth=function(b){a.canvas.freeDrawingBrush&&(a.canvas.freeDrawingBrush.width=parseInt(b,10)||1)};a.setDrawingLineOpacity=function(b){a.canvas.freeDrawingBrush&&(a.canvas.freeDrawingBrush.opacity=b)};a.setDrawingLineShadowWidth=function(b){a.canvas.freeDrawingBrush&&(b=parseInt(b,10)||1,a.canvas.freeDrawingBrush.shadow=0<b?new fabric.Shadow({blur:b,offsetX:10,offsetY:10}):null)};a.initBrushes=function(){fabric.PatternBrush&&(a.initVLinePatternBrush(),
a.initHLinePatternBrush(),a.initSquarePatternBrush(),a.initDiamondPatternBrush(),a.initImagePatternBrush())};a.initImagePatternBrush=function(){var b=new Image;b.src=od_mainURL+"images/honey_im_subtle.png";a.texturePatternBrush=new fabric.PatternBrush(canvas);a.texturePatternBrush.source=b};a.initDiamondPatternBrush=function(){a.diamondPatternBrush=new fabric.PatternBrush(canvas);a.diamondPatternBrush.getPatternSrc=function(){var a=fabric.document.createElement("canvas"),b=new fabric.Rect({width:10,
height:10,angle:45,fill:this.color}),d=b.getBoundingRectWidth();a.width=a.height=d+5;b.set({left:d/2,top:d/2});d=a.getContext("2d");b.render(d);return a}};a.initSquarePatternBrush=function(){a.squarePatternBrush=new fabric.PatternBrush(canvas);a.squarePatternBrush.getPatternSrc=function(){var a=fabric.document.createElement("canvas");a.width=a.height=12;var b=a.getContext("2d");b.fillStyle=this.color;b.fillRect(0,0,10,10);return a}};a.initVLinePatternBrush=function(){a.vLinePatternBrush=new fabric.PatternBrush(canvas);
a.vLinePatternBrush.getPatternSrc=function(){var a=fabric.document.createElement("canvas");a.width=a.height=10;var b=a.getContext("2d");b.strokeStyle=this.color;b.lineWidth=5;b.beginPath();b.moveTo(0,5);b.lineTo(10,5);b.closePath();b.stroke();return a}};a.initHLinePatternBrush=function(){a.hLinePatternBrush=new fabric.PatternBrush(canvas);a.hLinePatternBrush.getPatternSrc=function(){var a=fabric.document.createElement("canvas");a.width=a.height=10;var b=a.getContext("2d");b.strokeStyle=this.color;
b.lineWidth=5;b.beginPath();b.moveTo(5,0);b.lineTo(5,10);b.closePath();b.stroke();return a}};a.getRandomColor=function(){return colorTrend[Math.floor(Math.random()*colorTrend.length)]};a.addRect=function(){$("#opacity_shape").slider("value",0);var b=50<a.designerWidth?50:a.designerWidth;a.canvas.add(new fabric.Rect({left:0,top:0,fill:"#"+a.getRandomColor(),width:b,height:b,opacity:1}));a.ajustAfterAddItem("rect")};a.addCircle=function(){$("#opacity_shape").slider("value",0);var b=50<a.designerWidth?
50:a.designerWidth;a.canvas.add(new fabric.Circle({left:0,top:0,fill:"#"+a.getRandomColor(),radius:b,opacity:1}));a.ajustAfterAddItem("circle")};a.addTriangle=function(){$("#opacity_shape").slider("value",0);var b=50<a.designerWidth?50:a.designerWidth;a.canvas.add(new fabric.Triangle({left:0,top:0,fill:"#"+a.getRandomColor(),width:b,height:b,opacity:1}));a.ajustAfterAddItem("triangle")};a.addLine=function(){$("#opacity_shape").slider("value",0);a.canvas.add(new fabric.Line([50,100,200,200],{left:0,
top:0,stroke:"#"+a.getRandomColor()}));a.ajustAfterAddItem("line")};a.addPolygon=function(b){$("#opacity_shape").slider("value",0);a.canvas.add(new fabric.Polygon([{x:40,y:60},{x:60,y:74.641},{x:57.321,y:50},{x:80,y:40},{x:57.321,y:30},{x:60,y:5.359},{x:40,y:20},{x:20,y:5.359},{x:22.679,y:30},{x:0,y:40},{x:22.679,y:50},{x:20,y:74.641}],{left:0,top:0,fill:"#"+a.getRandomColor()}));a.ajustAfterAddItem("polygon")};a.setShapeColor=function(b){"line"===a.editable.type?a.changeStroke(b):a.changeColor(b)};
a.dosomething=function(){console.log("hello kitty")};a.onFileSelect=function(b){a.errorUpload="";a.progressUpload=0;a.file=[];for(var c=5,d=0;d<b.length;d++)if(-1===b[d].type.indexOf("image"))a.errorUpload="Only images are allowed";else if(window.parent.nbds_frontend.upload_max&&(c=window.parent.nbds_frontend.upload_max),b[d].size>1048576*c)a.errorUpload="Oops, file upload larger than "+window.parent.nbds_frontend.upload_max+" MB";else{a.file.push(b[d]);var e=new FileReader;e.readAsDataURL(b[d]);
(function(b,c){b.onload=function(b){t(function(){a.src=b.target.result})}})(e,d)}};a.startUpload=function(){if(""==a.errorUpload){jQuery('#upload-tabs a[href="#uploaded-photo"]').tab("show");a.loading=!0;for(var b=0;b<a.file.length;b++)a.progressUpload=1,a.upload=r.upload({url:window.parent.nbds_frontend.url,method:"POST",withCredentials:!0,data:{src:a.src,action:"nbdesigner_customer_upload",nonce:window.parent.nbds_frontend.nonce},file:a.file[b]}).progress(function(b){a.progressUpload=parseInt(100*
b.loaded/b.total)}).success(function(b,c,d,e){angular.isUndefined(b.src)?alert("The file exist or upload failed, try later !!"):(a.uploadURL.push(b.src),g.set(a.iid,a.uploadURL));a.loading=!1});0==a.file.length&&(a.loading=!1)}else alert(a.errorUpload)};a.loadLocalStorageImage=function(){a.disableDrawMode();var b=g.get(a.iid,a.uploadURL);b&&"array"==toType(b)&&(a.uploadURL=b);a.loaded=30};a.hasGetUserMedia=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia)};a.initWebcam=function(){a.statusWebcam=!0;Webcam.set({width:400,height:300,dest_width:1280,dest_height:960,image_format:"jpeg",jpeg_quality:100});Webcam.attach("#my_camera");Webcam.setSWFLocation(window.parent.nbds_frontend.url_style+"webcam.swf")};a.takeSnapshot=function(){show_indicator();Webcam.snap(function(b){a.resetWebcam();a.statusWebcam=!1;b=b.replace(/^data\:image\/\w+\;base64\,/,"");jQuery.ajax({url:window.parent.nbds_frontend.url,method:"POST",data:{action:"nbdesigner_save_webcam_image",
image:b,nonce:window.parent.nbds_frontend.nonce}}).done(function(b){hide_indicator();b=JSON.parse(b);"success"==b.flag?(jQuery("#dg-myclipart").modal("hide"),a.addImage(b.url)):(alert("Oops! Try again!"),a.initWebcam())})})};a.pauseWebcam=function(){Webcam.freeze()};a.unPauseWebcam=function(){Webcam.unfreeze()};a.resetWebcam=function(){a.statusWebcam?(Webcam.reset(),a.statusWebcam=!1,a.langs.STOPWEBCAM=a.langs.STARTWEBCAM?a.langs.STARTWEBCAM:"Start Webcam"):(a.initWebcam(),a.statusWebcam=!0,a.langs.STOPWEBCAM=
a.langs.STOPWEBCAM2?a.langs.STOPWEBCAM2:"Stop Webcam")};a.loadMoreFacebookPhoto=function(){""!=$("#nbdesigner_fb_next").val()&&nbdesigner_fb1()};a.addImage=function(b){a.zoom=1;a.zoomCanvas();fabric.Image.fromURL(b,function(b){a.canvas.add(b);a.showPopover("art");a.canvas.setActiveObject(a.canvas.item(a.canvas.getObjects().length-1));jQuery("#dg-myclipart").modal("hide");jQuery("#dg-qrcode").modal("hide");var c=.9*a.canvas.width,d=.9*a.canvas.height,e=c;b.width<c&&(e=b.width);c=e/b.width*b.height;
c>d&&(c=d,e=c/b.height*b.width);a.canvas.getActiveObject().set({scaleX:e/b.width,scaleY:c/b.height}).center().setCoords();b=a.canvas.getObjects().length-1;a.addLayers(a.canvas.getActiveObject(),"image",b);a.canvas.setActiveObject(a.canvas.item(b));a.drawCanvas()},{crossOrigin:"anonymous"})};a.addImageFromUrl=function(){""==a.imageFromUrl?alert("Image url empty!"):(show_indicator(),fabric.util.loadImage(a.imageFromUrl,function(b){null==b?alert("Error!"):jQuery.ajax({url:window.parent.nbds_frontend.url,
method:"POST",data:{action:"nbdesigner_copy_image_from_url",nonce:window.parent.nbds_frontend.nonce,url:a.imageFromUrl}}).done(function(b){b=JSON.parse(b);1==b.flag?(hide_indicator(),a.addImage(b.src)):(hide_indicator(),jQuery('#upload-tabs a[href="#upload-computer"]').tab("show"),alert("Try to download image and then upload to our server!"))})}))};a.resetImage=function(){var b=a.canvas.getActiveObject();null!=b&&(b.filters=[],b.applyFilters(),"custom-image"==a.canvas.item(a.editableItem).get("type")&&
(b=a.canvas.item(a.editableItem).origin_src,""!=b&&(a.canvas.remove(a.canvas.getActiveObject()),a.addImage(b))),a.drawCanvas())};a.loadSource=function(){var b=g.get(a.iid,a.uploadURL);b&&"array"==toType(b)&&(a.uploadURL=b);a.loaded=30};a.initCropCanvas=function(b){canvas2.clear();canvas2.calcOffset();canvas2.setZoom(1);canvas2.renderAll();canvas2.isDrawingMode=!1;if(null!=a.editableItem){"crop"===b?(a.cropToolMode=!0,a.clipPathMode=!1):(a.cropToolMode=!1,a.clipPathMode=!0);var c=400;b=400;b="";"image"==
a.canvas.item(a.editableItem).get("type")&&(b=a.canvas.item(a.editableItem).getSvgSrc());"custom-image"==a.canvas.item(a.editableItem).get("type")&&(b=a.canvas.item(a.editableItem).origin_src);var d=b;a.canvas.item(a.editableItem);if(""!=d){a.modeMobile?(c=$(window).width()-20,b=250):(c=600,b=400);canvas2.setDimensions({width:c,height:b});$("#shape_canvas").css({width:c,height:b});var e=1,h=new Image;h.onload=function(){op=new fabric.Image(h);canvas2.add(op);var b=op.width;op.width>c&&(b=c);var b=
op.width/b,d=op.height/b;e=b;400<d&&(d=op.height/400,b=op.width/d,e=d);canvas2.item(0).set({top:0,left:0,scaleX:1/e,scaleY:1/e,selectable:!1,hasControls:!1,hasBorders:!1,opacity:.7}).center().setCoords();canvas2.renderAll();if(a.cropToolMode){var g=new fabric.Path(listPath.path_crop),b=new fabric.Path(listPath.path_crop);a.currentPathCrop=listPath.path_crop;g.set({originX:"center",originY:"center",scaleX:e,scaleY:e,fill:"#9bf0e9",opacity:0});b.set({originX:"center",originY:"center",opacity:0,hasRotatingPoint:!1,
centeredScaling:!0})}else g=new fabric.Path(listPath.path_1),b=new fabric.Path(listPath.path_1),a.currentPathCrop=listPath.path_1,g.set({originX:"center",originY:"center",scaleX:3*e,scaleY:3*e,fill:"#9bf0e9",opacity:0}),b.set({originX:"center",originY:"center",opacity:0,scaleX:3,scaleY:3,hasRotatingPoint:!1,centeredScaling:!0});canvas2.renderAll();d=new fabric.Image(h,{top:0,left:0,scaleX:1/e,scaleY:1/e,selectable:!1,hasControls:!1,hasBorders:!1});canvas2.add(d);document.getElementById("shape_canvas").getContext("2d");
canvas.item(1);canvas2.item(1).set({clipTo:function(a){g.render(a)}}).center().setCoords();canvas2.add(b);canvas2.item(2).set({borderColor:"rgba(220, 220, 220, 1)"});canvas2.item(2).setControlVisible("tl",!1);canvas2.item(2).setControlVisible("bl",!1);canvas2.item(2).center().setCoords();canvas2.setActiveObject(canvas2.item(2));canvas2.renderAll()};h.src=d}}};a.cropImage=function(){var b="";"image"==a.canvas.item(a.editableItem).get("type")&&(b=a.canvas.item(a.editableItem).getSvgSrc());"custom-image"==
a.canvas.item(a.editableItem).get("type")&&(b=a.canvas.item(a.editableItem).get("origin_src"));var d=b,e=canvas2.item(2).get("width"),h=canvas2.item(2).get("height"),g=canvas2.item(2).get("scaleX"),b=canvas2.item(2).get("left"),k=canvas2.item(2).get("top"),l=canvas2.item(1).get("top"),p=canvas2.item(1).get("left"),q=1/canvas2.item(0).get("scaleX");canvas2.remove(canvas2.item(0));canvas2.remove(canvas2.item(2));for(var r=canvas2.getObjects().length;1<r;)canvas2.remove(canvas2.item(1)),r=canvas2.getObjects().length;
canvas2.item(0).set({left:g*e/2-b+p,top:g*h/2-k+l});canvas2.setDimensions({width:g*e*q,height:g*h*q});canvas2.calcOffset();canvas2.setZoom(q);canvas2.renderAll();var n=new Image;n.src=canvas2.deactivateAll().toDataURL();n.onload=function(){var b=new fabric.CustomImage(n,{origin_src:d});a.canvas.remove(a.canvas.getActiveObject());a.canvas.add(b);var b=g*e*q,c=g*h*q;jQuery("#dg-crop-image").modal("hide");var k=.7*a.canvas.width,l=.7*a.canvas.height,m=k;b<k&&(m=b);k=m/b*c;k>l&&(k=l,m=k/c*b);l=a.canvas.getObjects().length-
1;a.canvas.setActiveObject(a.canvas.item(l));a.addLayers(a.canvas.getActiveObject(),"custom-image",l);a.canvas.getActiveObject().set({scaleX:m/b,scaleY:k/c}).center().setCoords();a.drawCanvas()}};a.lassoTool=function(){a.cropToolMode=!0;a.clipPathMode=!1;canvas2.remove(canvas2.item(2));canvas2.item(1).set({clipTo:function(a){a.rect(0,0,0,0)}});canvas2.renderAll();canvas2.isDrawingMode=!0;a.freeDrawingMode="Pencil";canvas2.freeDrawingBrush=new fabric.PencilBrush(canvas2)};a.cropTool=function(){a.cropToolMode=
!0;a.clipPathMode=!1;a.currentPathCrop=listPath.path_crop;path2=new fabric.Path(a.currentPathCrop);path2.set({originX:"center",originY:"center",opacity:0,hasRotatingPoint:!1,centeredScaling:!0});canvas2.remove(canvas2.item(2));canvas2.add(path2);canvas2.item(2).center().setCoords();canvas2.item(2).setControlVisible("tl",!1);canvas2.item(2).setControlVisible("bl",!1);canvas2.setActiveObject(canvas2.item(2));canvas2.renderAll()};a.clipPath=function(b){a.currentPathCrop=listPath["path_"+b];path2=new fabric.Path(a.currentPathCrop);
path2.set({originX:"center",originY:"center",opacity:0,hasRotatingPoint:!1,scaleX:3,scaleY:3,centeredScaling:!0});canvas2.remove(canvas2.item(2));canvas2.add(path2);canvas2.item(2).center().setCoords();canvas2.item(2).setControlVisible("tl",!1);canvas2.item(2).setControlVisible("bl",!1);canvas2.setActiveObject(canvas2.item(2));canvas2.renderAll()};a.toggleLockLayer=function(b){var d=!a.canvas.item(b.index).get("selectable"),c="#layer-"+b.index;a.canvas.item(b.index).set({selectable:d});d?(jQuery(c).removeClass("lock"),
jQuery(c+" .nbdesigner_lock_layer i").removeClass("fa-lock"),jQuery(c+" .nbdesigner_lock_layer i").addClass("fa-unlock-alt")):(jQuery(c).addClass("lock"),jQuery(c+" .nbdesigner_lock_layer i").addClass("fa-lock"),jQuery(c+" .nbdesigner_lock_layer i").removeClass("fa-unlock-alt"));a.canvas.deactivateAll();a.drawCanvas()};a.duplicateItem=function(){var b=canvas.getActiveObject();null!=b&&(b=fabric.util.object.clone(b),a.canvas.add(b),b=a.canvas.getObjects().length-1,a.canvas.deactivateAll(),a.canvas.setActiveObject(a.canvas.item(b)),
a.drawCanvas(),a.updateCurrentLayerAfterDelete())};a.init=function(){show_indicator();checkNavigator()?(a.canvas=canvas,a.loaded=0,a.loadSource(),a.loadLanguage(),a.loadProduct(""),a.initBrushes(),window.parent.NBDESIGNERPRODUCT.nbdesigner_ready(),(checkFireFox()||checkIE())&&jQuery("input.jscolor").removeAttr("disabled")):hide_indicator()};a.init();a.debug=function(){a.backgroundId+=1};a.changeBackgroundId=function(b){a.backgroundId=b};a.state="pub";window.scope=a});
angular.module("app").factory("ArtService",function(a){return{fn:function(b){$("#loading_art_upload").hasClass("hidden")&&$("#loading_art_upload").removeClass("hidden");a({method:"POST",url:window.parent.nbds_frontend.url,params:{action:"nbdesigner_get_art",nonce:window.parent.nbds_frontend.nonce_get}}).success(function(a,g,h,d){b(a);$("#loading_art_upload").hasClass("hidden")||$("#loading_art_upload").addClass("hidden")}).error(function(a,b,h,d){alert("Error! Try again!");$("#loading_art_upload").hasClass("hidden")||
$("#loading_art_upload").addClass("hidden")})}}});
angular.module("app").factory("FontService",function(a){return{fn:function(b){$("#loading_font_upload").hasClass("hidden")&&$("#loading_font_upload").removeClass("hidden");a({method:"POST",url:window.parent.nbds_frontend.url,params:{action:"nbdesigner_get_font",nonce:window.parent.nbds_frontend.nonce_get}}).success(function(a,g,h,d){b(a);$("#loading_font_upload").hasClass("hidden")||$("#loading_font_upload").addClass("hidden")}).error(function(a,b,h,d){alert("Error! Try again!");$("#loading_font_upload").hasClass("hidden")||
$("#loading_font_upload").addClass("hidden")})}}});
angular.module("app").factory("PatternService",function(a,b){return{fn:function(a){$("#loading_pattern").hasClass("hidden")&&$("#loading_pattern").removeClass("hidden");b({method:"POST",url:window.parent.nbds_frontend.url,params:{action:"nbdesigner_get_pattern",nonce:window.parent.nbds_frontend.nonce_get}}).success(function(b,e,d,k){a(b);$("#loading_pattern").hasClass("hidden")||$("#loading_pattern").addClass("hidden")}).error(function(a,b,d,e){alert("Error! Try again!");$("#loading_pattern").hasClass("hidden")||
$("#loading_pattern").addClass("hidden")})}}});angular.module("app").service("PriceService",function(){});
angular.module("app").service("ProductService",function(a,b){this.getProduct=function(e,g){var h=b.defer();a({url:window.parent.nbds_frontend.url,method:"POST",data:"action=nbdesigner_get_product_info&nonce="+window.parent.nbds_frontend.nonce+"&id="+product_id+"&oid="+orderid+"&did="+e+"&variation="+g,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,e,g){h.resolve(a)}).error(function(a,b,e,g){h.reject(a)});return h.promise}});
angular.module("app").factory("QrcodeService",function(a){return{fn:function(b,e){$("#loading_qrcode").removeClass("hidden");a({method:"POST",url:window.parent.nbds_frontend.url,params:{data:b,action:"nbdesigner_get_qrcode",nonce:window.parent.nbds_frontend.nonce}}).success(function(a,b,d,k){e(a);$("#loading_qrcode").addClass("hidden")}).error(function(a,b,d,e){$("#loading_qrcode").addClass("hidden");alert("Error! Try again!")})}}});
angular.module("app").service("LanguageService",function(a,b){this.getLang=function(e){var g=b.defer();a({url:window.parent.nbds_frontend.url,method:"POST",data:"action=nbdesigner_get_language&nonce="+window.parent.nbds_frontend.nonce+"&code="+e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,e,l){g.resolve(a)}).error(function(a,b,e,l){g.reject(a)});return g.promise}});
angular.module("app").service("AdminTemplateService",function(a,b){this.getDesign=function(e){var g=b.defer();a({url:window.parent.nbds_frontend.url,method:"POST",data:"action=nbdesigner_load_admin_design&nonce="+window.parent.nbds_frontend.nonce+"&id="+e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b,e,l){g.resolve(a)}).error(function(a,b,e,l){g.reject(a)});return g.promise}});
var NBDESIGNERCART={dataImage:{},dataJson:{},flag:0,setDataImage:function(a){this.dataImage=a},setDataJson:function(a){this.dataJson=a},setFlag:function(){this.flag=0},upload_design:function(a,b,e,g){show_indicator();b=JSON.stringify(b);_fonts="admindesign"==OD_task?JSON.stringify(e):"";_config=JSON.stringify(g);jQuery.ajax({url:window.parent.nbds_frontend.url,method:"POST",data:{action:"nbdesigner_save_customer_design",image:{img:a,json:b},nonce:window.parent.nbds_frontend.nonce,sid:window.parent.nbds_frontend.sid,
adid:adid,product_id:product_id,orderid:orderid,task:OD_task,fonts:_fonts,config:_config,priority:OD_priority}}).done(function(a){a=JSON.parse(a);"success"==a.flag?(window.parent.NBDESIGNERPRODUCT.show_design_thumbnail(a.image),window.parent.hideDesignFrame(),""!=a.redesign?window.parent.hideDesignFrame(a.redesign):window.parent.hideDesignFrame()):"pendding"==a.flag?""!=a.redesign&&window.parent.hideDesignFrame(a.redesign):alert("Something wrong! Please try again...");hide_indicator()})},ajax_upload:function(a,
b,e){e="frame_"+e;var g={};g[e]=a[e];console.log(g);a={img:g,json:b};self=this;jQuery.ajax({url:window.parent.nbds_frontend.url,method:"POST",data:{action:"nbdesigner_save_customer_design",image:a,nonce:window.parent.nbds_frontend.nonce,sid:window.parent.nbds_frontend.sid,product_id:product_id,orderid:orderid}}).done(function(a){a=JSON.parse(a);"success"==a.flag?(a=parseInt(self.flag)+1,self.flag=a,self.dataImage["frame_"+self.flag]?(console.log(self.flag),self.ajax_upload(self.dataImage,self.dataJson,
self.flag)):(console.log("complete!"),hide_indicator())):"pendding"==a.flag?""!=a.redesign&&window.parent.hideDesignFrame(a.redesign):alert("Something wrong! Please try again...");hide_indicator()})}},nbdesigner_fb=function(){FB.getLoginStatus(function(a){"connected"===a.status&&(a=a.authResponse.accessToken,console.log(a),jQuery.ajax({url:window.parent.nbds_frontend.url,method:"POST",data:{action:"nbdesigner_get_facebook_photo",nonce:window.parent.nbds_frontend.nonce,accessToken:a},beforeSend:function(){},
success:function(a){a=JSON.parse(a);if(a.img){var b="";$.each(a.img,function(a,e){b+='<img class="img-responsive img-thumbnail nbdesigner_upload_image shadow hover-shadow" data-url="" onclick="NBDESIGNERFUNC.addFacebookImage(\''+e+'\', this)" src="'+e+'" />'});$("#uploaded-facebook").append(b)}}}))})},nbdesigner_fb1=function(){$("#loading_fb_upload").removeClass("hidden");FB.getLoginStatus(function(a){if("connected"===a.status){var b=a.authResponse.userID;a=a.authResponse.accessToken;var e=$("#nbdesigner_fb_next").val();
$.getJSON(""==e?"https://graph.facebook.com/"+b+"/photos/uploaded/?limit=5&fields=source,images,link&access_token="+a:e,function(){console.log("Get album success!")}).done(function(a){var b="";$.each(a.data,function(a,e){var d;d=e.images?e.images[0].source:e.source;b+='<img class="img-responsive img-thumbnail nbdesigner_upload_image shadow hover-shadow" data-url="" onclick="NBDESIGNERFUNC.addFacebookImage(\''+d+'\', this)" src="'+d+'" />'});$("#uploaded-facebook").prepend(b);a.paging.next?($("#nbdesigner_fb_next").val(a.paging.next),
$("#facebook-load-more").hasClass("hidden")&&$("#facebook-load-more").removeClass("hidden")):($("#nbdesigner_fb_next").val(""),$("#facebook-load-more").hasClass("hidden")||$("#facebook-load-more").addClass("hidden"));$("#loading_fb_upload").hasClass("hidden")||$("#loading_fb_upload").addClass("hidden")}).fail(function(){$("#loading_fb_upload").hasClass("hidden")||$("#loading_fb_upload").addClass("hidden")}).always(function(){$("#loading_fb_upload").hasClass("hidden")||$("#loading_fb_upload").addClass("hidden")})}})},
NBDESIGNERFUNC={addFacebookImage:function(a,b){var e=jQuery(b).attr("data-url"),g=jQuery(b),h=angular.element(document.getElementById("designer-controller")).scope();""!=e?h.addImage(e):(show_indicator(),jQuery.ajax({url:window.parent.nbds_frontend.url,method:"POST",data:{action:"nbdesigner_copy_image_from_url",nonce:window.parent.nbds_frontend.nonce,url:a}}).done(function(a){a=JSON.parse(a);1==a.flag?(g.attr("data-url",a.src),h.addImage(a.src)):(alert("Try to download image and then upload to our server!"),
jQuery('#upload-tabs a[href="#upload-computer"]').tab("show"));hide_indicator()}));"$apply"!==h.$root.$$phase&&"$digest"!==h.$root.$$phase&&h.$apply()},addQrImage:function(a){var b=angular.element(document.getElementById("designer-controller")).scope();b.addImage(a);"$apply"!==b.$root.$$phase&&"$digest"!==b.$root.$$phase&&b.$apply()}};
angular.module("app").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():a}}).filter("startFrom",function(){return function(a,b){return a.slice(+b)}}).filter("filterCat",function(){return function(a,b){var e=[];_.each(a,function(a,h){a.cat||(a.cat=["99"]);0==a.cat.length&&(a.cat=["0"]);0<=$.inArray(b,a.cat)&&e.push(a)});return e}}).filter("range",function(){return function(a,b){b=parseInt(b);for(var e=0;e<b;e++)a.push(e);return a}});
angular.module("app").directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(a){a.initCarousel=function(b){var e={},g=a.$eval($(b).attr("data-options")),h;for(h in g)e[h]=g[h];$(b).owlCarousel(e)}}}}).directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(a,b){a.$last&&a.initCarousel(b.parent())}}}]).directive("pathArtDirective",[function(){return function(a,b,e){a.$last&&(jscolor.installByClassName("jscolor"),(checkFireFox()||checkIE())&&
jQuery("input.jscolor").removeAttr("disabled"))}}]);
jQuery(document).ready(function(a){a(window.parent.document).find(".variations_form.cart").on("change",function(){var b=a(window.parent.document).find('input[name="variation_id"]').val(),e=angular.element(document.getElementById("designer-controller")).scope();""!=b&&window.parent.NBDESIGNERPRODUCT.nbdesigner_unready();e.onLoadProduct||""==b||(e.loaded=0,e.onLoadProduct=!0,show_indicator(),e.canvas.clear(),e.loadProduct(product_id,b));"$apply"!==e.$root.$$phase&&"$digest"!==e.$root.$$phase&&e.$apply()});
a(window.parent.document).find(".reset_variations").on("click",function(){var a=angular.element(document.getElementById("designer-controller")).scope();window.parent.NBDESIGNERPRODUCT.nbdesigner_unready();a.onLoadProduct||(a.loaded=0,a.onLoadProduct=!0,show_indicator(),a.canvas.clear(),a.loadProduct(product_id,0));"$apply"!==a.$root.$$phase&&"$digest"!==a.$root.$$phase&&a.$apply()})});